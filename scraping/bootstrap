#!/bin/bash
# This is the correct bootstrap pattern that AWS Lambda expects

# Get the handler name from the first argument
handler=$1

if [ -z "$handler" ]; then
  echo "ERROR: Lambda handler name is required as the first argument"
  exit 1
fi

if [ "$BACKFILL_MODE" = "true" ]; then
  echo "Running in backfill mode with handler: $handler"
  # For Lambda we need to execute the specific handler we want
  # Ignoring the handler argument and using our fixed handler
  exec /var/lang/bin/python3 -m awslambdaric backfill_runner.lambda_handler
else
  echo "Running in standard mode with handler: $handler"
  # For Lambda we need to execute the specific handler we want
  # Ignoring the handler argument and using our fixed handler
  exec /var/lang/bin/python3 -m awslambdaric lambda_function.lambda_handler
fi
